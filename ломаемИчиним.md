# Как чинили  k8s на тесте.

За 7 дней было предупреждение того что выходят сертификаты
На мастерах был выполнен 
kubeadm certs check-expiration # посмотреть когда выходит действия сертификата
kubeadm certs renew	all      # обновить сертификаты

 При выполнении 
kubeadm certs check-expiration - на мастерах якобы сертификаты обновились 

Но, как показала время kubelet сертификаты не обновились.

Полезные статьи
https://habr.com/ru/companies/aenix/articles/541118/
https://habr.com/ru/companies/aenix/articles/544390/


Проверка сертификата kubelet.conf  ( ./cert.sh kubelet.conf )

#!/bin/bash
[ -f "$1" ] || exit
if [[ $1 =~ \.(crt|pem)$ ]]; then
 openssl x509 -in "$1" -text -noout
fi
if [[ $1 =~ \.conf$ ]]; then
 certfile=$(mktemp)
 grep 'client-certificate-data:' "$1"| awk '{ print $2}' | base64 -d > "$certfile"
 openssl x509 -in "$certfile" -text -noout
 rm -f "$certfile"
fi

Проверка остальных сертификатов
openssl x509 -enddate -noout -in healthcheck-client.crt


Обновили kubelet.conf на test-k8s-master-01
kubeadm kubeconfig user --org system:nodes --client-name system:node:test-k8s-master-01 --config /etc/kubernetes/initconfiguration.yml > /etc/kubernetes/kubelet.conf





